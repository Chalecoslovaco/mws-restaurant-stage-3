"use strict";var _createClass=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var DBHelper=function(){function i(){_classCallCheck(this,i)}return _createClass(i,null,[{key:"openDatabase",value:function(){return navigator.serviceWorker?idb.open("restaurants",1,function(e){e.createObjectStore("restaurants",{keyPath:"id"})}):Promise.resolve()}},{key:"populateDatabase",value:function(r){return i.openDatabase().then(function(e){if(e){var t=e.transaction("restaurants","readwrite"),n=t.objectStore("restaurants");return r.forEach(function(e){n.put(e)}),t.complete}})}},{key:"getIdbRestaurants",value:function(){return i.openDatabase().then(function(e){if(e)return e.transaction("restaurants").objectStore("restaurants").getAll()})}},{key:"fetchRestaurants",value:function(t){return i.getIdbRestaurants().then(function(e){return e.length?e:fetch(i.DATABASE_URL).then(function(e){return e.json()}).then(function(e){return i.populateDatabase(e),e})}).then(function(e){t(null,e)})}},{key:"fetchRestaurantById",value:function(r,u){i.fetchRestaurants(function(e,t){if(e)u(e,null);else{var n=t.find(function(e){return e.id==r});n?u(null,n):u("Restaurant does not exist",null)}})}},{key:"fetchRestaurantByCuisine",value:function(r,u){i.fetchRestaurants(function(e,t){if(e)u(e,null);else{var n=t.filter(function(e){return e.cuisine_type==r});u(null,n)}})}},{key:"fetchRestaurantByNeighborhood",value:function(r,u){i.fetchRestaurants(function(e,t){if(e)u(e,null);else{var n=t.filter(function(e){return e.neighborhood==r});u(null,n)}})}},{key:"fetchRestaurantByCuisineAndNeighborhood",value:function(r,u,a){i.fetchRestaurants(function(e,t){if(e)a(e,null);else{var n=t;"all"!=r&&(n=n.filter(function(e){return e.cuisine_type==r})),"all"!=u&&(n=n.filter(function(e){return e.neighborhood==u})),a(null,n)}})}},{key:"fetchNeighborhoods",value:function(u){i.fetchRestaurants(function(e,n){if(e)u(e,null);else{var r=n.map(function(e,t){return n[t].neighborhood}),t=r.filter(function(e,t){return r.indexOf(e)==t});u(null,t)}})}},{key:"fetchCuisines",value:function(u){i.fetchRestaurants(function(e,n){if(e)u(e,null);else{var r=n.map(function(e,t){return n[t].cuisine_type}),t=r.filter(function(e,t){return r.indexOf(e)==t});u(null,t)}})}},{key:"urlForRestaurant",value:function(e){return"./restaurant.html?id="+e.id}},{key:"imageUrlForRestaurant",value:function(e,t){return 10==e.id&&(e.photograph=10),"dist/img/"+e.photograph+"-"+t+".webp"}},{key:"mapMarkerForRestaurant",value:function(e,t){return new google.maps.Marker({position:e.latlng,title:e.name,url:i.urlForRestaurant(e),map:t,animation:google.maps.Animation.DROP})}},{key:"addReview",value:function(e){fetch(i.REVIEWS_URL,{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})}},{key:"fetchReviews",value:function(n){fetch(i.REVIEWS_URL).then(function(e){return e.json()}).then(function(e){var t=e.filter(function(e){return e.restaurant_id==n});t?fillReviewsHTML(t):fillReviewsHTML(null)})}},{key:"DATABASE_URL",get:function(){return"http://localhost:1337/restaurants"}},{key:"REVIEWS_URL",get:function(){return"http://localhost:1337/reviews/"}}]),i}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImRiaGVscGVyLmpzIl0sIm5hbWVzIjpbIkRCSGVscGVyIiwibmF2aWdhdG9yIiwic2VydmljZVdvcmtlciIsImlkYiIsInRoZW4iLCJ1cGdyYWRlRGIiLCJjcmVhdGVPYmplY3RTdG9yZSIsImtleVBhdGgiLCJQcm9taXNlIiwicmVzb2x2ZSIsInJlc3RhdXJhbnRzIiwiY29tcGxldGUiLCJkYiIsInR4IiwidHJhbnNhY3Rpb24iLCJzdG9yZSIsIm9iamVjdFN0b3JlIiwiZm9yRWFjaCIsInJlc3RhdXJhbnQiLCJvcGVuRGF0YWJhc2UiLCJnZXRBbGwiLCJjYWxsYmFjayIsImZldGNoIiwiREFUQUJBU0VfVVJMIiwicmVzcG9uc2UiLCJqc29uIiwicG9wdWxhdGVEYXRhYmFzZSIsImZldGNoUmVzdGF1cmFudHMiLCJlcnJvciIsImZpbmQiLCJyIiwiaWQiLCJjdWlzaW5lIiwiZmlsdGVyIiwicmVzdWx0cyIsIm5laWdoYm9yaG9vZCIsImN1aXNpbmVfdHlwZSIsIm1hcCIsInYiLCJpIiwibmVpZ2hib3Job29kcyIsImluZGV4T2YiLCJjdWlzaW5lcyIsInNpemUiLCJwaG90b2dyYXBoIiwiZ29vZ2xlIiwibWFwcyIsIk1hcmtlciIsImxhdGxuZyIsInRpdGxlIiwibmFtZSIsInVybCIsInVybEZvclJlc3RhdXJhbnQiLCJhbmltYXRpb24iLCJyZXZpZXciLCJSRVZJRVdTX1VSTCIsInVuaXF1ZUN1aXNpbmVzIiwibWV0aG9kIiwiaGVhZGVycyIsIkNvbnRlbnQtVHlwZSIsImJvZHkiLCJKU09OIiwic3RyaW5naWZ5IiwicmV2aWV3cyIsInJldmlld3NCeUlkIiwicmVzdGF1cmFudF9pZCIsImZpbGxSZXZpZXdzSFRNTCJdLCJtYXBwaW5ncyI6ImlZQUtNQSwwSEErQkgsT0FBQUMsVUFBQUMsY0FHQ0MsSUFBT0gsS0FBQUEsY0FBQSxFQUF3QkksU0FBS0MsR0FDMUJBLEVBQUFDLGtCQUFBLGNBQUEsQ0FQTkMsUUFBUyxTQUxKQyxRQUFRQyxtREFnQmZDLEdB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QS9CLElBQTZDRCxFQUE3Qyx1REF6QjBCekIsRUFBQ1UsR0FNdkIsT0FMUyxJQUFBaUIsT0FBQUMsS0FBQUMsT0FBQSxDQUNUMUIsU0FBQUEsRUFBZ0IyQixPQUNqQkMsTUFGRC9CLEVBRU9nQyxLQUNMQyxJQUFBbkQsRUFBQW9ELGlCQUFBbEMsR0FDQW1CLElBQUFBLEVBQWlDZ0IsVUFBQVIsT0FBVW5DLEtBQUFBLFVBQWUwQix5Q0FFMURrQixHQUNBakMsTUFBQUEsRUFBU2tDLFlBQU1DLENBQ2hCQyxPQUFBLE9BQ0ZDLFFBVkQsQ0FXREMsZUFBQSxvQkFFREMsS0FBQUMsS0FBQUMsVUFBQVIsMENBdUNvQnZCLEdBQ2xCVCxNQUFNdEIsRUFBU3VELGFBQ1JuRCxLQUFLLFNBQVNvQixHQXJDckIsT0FBQUEsRUFBQUMsU0FDRHJCLEtBQUEsU0FBQTJELEdBdUNPLElBQU1DLEVBQWNELEVBQVE5QixPQUFPLFNBQUFILEdBQUEsT0FBS0EsRUFBRW1DLGVBQWlCbEMsSUFyQ25FaUMsRUF1Q1VFLGdCQUFnQkYsR0FFaEJFLGdCQUFnQiw2Q0FoT3hCLE1BQUEsd0VBS0UsTUFBQSIsImZpbGUiOiJkYmhlbHBlci5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxyXG4gKiBDb21tb24gZGF0YWJhc2UgaGVscGVyIGZ1bmN0aW9ucy5cclxuICovXHJcblxyXG5cclxuY2xhc3MgREJIZWxwZXIge1xyXG5cclxuICAvKipcclxuICAgKiBEYXRhYmFzZSBVUkwuXHJcbiAgICogQ2hhbmdlIHRoaXMgdG8gcmVzdGF1cmFudHMuanNvbiBmaWxlIGxvY2F0aW9uIG9uIHlvdXIgc2VydmVyLlxyXG4gICAqL1xyXG5cclxuICAvKnN0YXRpYyBnZXQgREFUQUJBU0VfVVJMKCkge1xyXG4gICAgY29uc3QgcG9ydCA9IDgwODAgLy8gQ2hhbmdlIHRoaXMgdG8geW91ciBzZXJ2ZXIgcG9ydFxyXG4gICAgcmV0dXJuIGBodHRwOi8vbG9jYWxob3N0OiR7cG9ydH0vZGF0YS9yZXN0YXVyYW50cy5qc29uYDtcclxuICB9Ki9cclxuICBzdGF0aWMgZ2V0IERBVEFCQVNFX1VSTCgpIHtcclxuICAgIGNvbnN0IHBvcnQgPSAxMzM3OyAvLyBDaGFuZ2UgdGhpcyB0byB5b3VyIHNlcnZlciBwb3J0XHJcbiAgICByZXR1cm4gYGh0dHA6Ly9sb2NhbGhvc3Q6JHtwb3J0fS9yZXN0YXVyYW50c2A7XHJcbiAgfVxyXG5cclxuICBzdGF0aWMgZ2V0IFJFVklFV1NfVVJMKCkge1xyXG4gICAgY29uc3QgcG9ydCA9IDEzMzc7IC8vIENoYW5nZSB0aGlzIHRvIHlvdXIgc2VydmVyIHBvcnRcclxuICAgIHJldHVybiBgaHR0cDovL2xvY2FsaG9zdDoke3BvcnR9L3Jldmlld3MvYDtcclxuICB9XHJcblxyXG4gIHN0YXRpYyBvcGVuRGF0YWJhc2UoKSB7XHJcbiAgICBpZighbmF2aWdhdG9yLnNlcnZpY2VXb3JrZXIpe1xyXG4gICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCk7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIGlkYi5vcGVuKCdyZXN0YXVyYW50cycsIDEsIGZ1bmN0aW9uICh1cGdyYWRlRGIpIHtcclxuICAgICAgdmFyIHN0b3JlID0gdXBncmFkZURiLmNyZWF0ZU9iamVjdFN0b3JlKCdyZXN0YXVyYW50cycsIHtcclxuICAgICAgICBrZXlQYXRoOiAnaWQnXHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBzdGF0aWMgcG9wdWxhdGVEYXRhYmFzZShyZXN0YXVyYW50cyl7XHJcbiAgICByZXR1cm4gREJIZWxwZXIub3BlbkRhdGFiYXNlKCkudGhlbihmdW5jdGlvbihkYil7XHJcbiAgICAgIGlmKCFkYikgcmV0dXJuO1xyXG5cclxuICAgICAgdmFyIHR4ID0gZGIudHJhbnNhY3Rpb24oJ3Jlc3RhdXJhbnRzJywgJ3JlYWR3cml0ZScpO1xyXG4gICAgICB2YXIgc3RvcmUgPSB0eC5vYmplY3RTdG9yZSgncmVzdGF1cmFudHMnKTtcclxuICAgICAgcmVzdGF1cmFudHMuZm9yRWFjaChmdW5jdGlvbiAocmVzdGF1cmFudCkge1xyXG4gICAgICAgICAgc3RvcmUucHV0KHJlc3RhdXJhbnQpO1xyXG4gICAgICB9KTtcclxuICAgICAgcmV0dXJuIHR4LmNvbXBsZXRlO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBzdGF0aWMgZ2V0SWRiUmVzdGF1cmFudHMoKXtcclxuICAgIHJldHVybiBEQkhlbHBlci5vcGVuRGF0YWJhc2UoKS50aGVuKGZ1bmN0aW9uKGRiKXtcclxuICAgICAgaWYoIWRiKSByZXR1cm47XHJcblxyXG4gICAgICB2YXIgdHggPSBkYi50cmFuc2FjdGlvbigncmVzdGF1cmFudHMnKTtcclxuICAgICAgdmFyIHN0b3JlID0gdHgub2JqZWN0U3RvcmUoJ3Jlc3RhdXJhbnRzJyk7XHJcbiAgICAgIHJldHVybiBzdG9yZS5nZXRBbGwoKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRmV0Y2ggYWxsIHJlc3RhdXJhbnRzLlxyXG4gICAqL1xyXG4gIHN0YXRpYyBmZXRjaFJlc3RhdXJhbnRzKGNhbGxiYWNrKSB7XHJcbiAgICAvKmxldCB4aHIgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTtcclxuICAgIHhoci5vcGVuKCdHRVQnLCBEQkhlbHBlci5EQVRBQkFTRV9VUkwpO1xyXG4gICAgeGhyLm9ubG9hZCA9ICgpID0+IHtcclxuICAgICAgaWYgKHhoci5zdGF0dXMgPT09IDIwMCkgeyAvLyBHb3QgYSBzdWNjZXNzIHJlc3BvbnNlIGZyb20gc2VydmVyIVxyXG4gICAgICAgIGNvbnN0IGpzb24gPSBKU09OLnBhcnNlKHhoci5yZXNwb25zZVRleHQpO1xyXG4gICAgICAgIGNvbnN0IHJlc3RhdXJhbnRzID0ganNvbi5yZXN0YXVyYW50cztcclxuICAgICAgICBjYWxsYmFjayhudWxsLCByZXN0YXVyYW50cyk7XHJcbiAgICAgIH0gZWxzZSB7IC8vIE9vcHMhLiBHb3QgYW4gZXJyb3IgZnJvbSBzZXJ2ZXIuXHJcbiAgICAgICAgY29uc3QgZXJyb3IgPSAoYFJlcXVlc3QgZmFpbGVkLiBSZXR1cm5lZCBzdGF0dXMgb2YgJHt4aHIuc3RhdHVzfWApO1xyXG4gICAgICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKTtcclxuICAgICAgfVxyXG4gICAgfTtcclxuICAgIHhoci5zZW5kKCk7Ki9cclxuICAgIHJldHVybiBEQkhlbHBlci5nZXRJZGJSZXN0YXVyYW50cygpLnRoZW4oKHJlc3RhdXJhbnRzKSA9PiB7XHJcbiAgICAgIGlmIChyZXN0YXVyYW50cy5sZW5ndGgpIHtcclxuICAgICAgICByZXR1cm4gcmVzdGF1cmFudHM7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgcmV0dXJuIGZldGNoKERCSGVscGVyLkRBVEFCQVNFX1VSTClcclxuICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKXtcclxuICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmpzb24oKTtcclxuICAgICAgICB9KS50aGVuKHJlc3RhdXJhbnRzID0+IHtcclxuICAgICAgICAgICAgREJIZWxwZXIucG9wdWxhdGVEYXRhYmFzZShyZXN0YXVyYW50cyk7XHJcbiAgICAgICAgICAgIHJldHVybiByZXN0YXVyYW50cztcclxuICAgICAgICB9KTtcclxuICAgICAgfVxyXG4gICAgfSkudGhlbihyZXN0YXVyYW50cyA9PiB7XHJcbiAgICAgIGNhbGxiYWNrKG51bGwsIHJlc3RhdXJhbnRzKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRmV0Y2ggYSByZXN0YXVyYW50IGJ5IGl0cyBJRC5cclxuICAgKi9cclxuICBzdGF0aWMgZmV0Y2hSZXN0YXVyYW50QnlJZChpZCwgY2FsbGJhY2spIHtcclxuICAgIC8vIGZldGNoIGFsbCByZXN0YXVyYW50cyB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cclxuICAgIERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoKGVycm9yLCByZXN0YXVyYW50cykgPT4ge1xyXG4gICAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgICBjYWxsYmFjayhlcnJvciwgbnVsbCk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgY29uc3QgcmVzdGF1cmFudCA9IHJlc3RhdXJhbnRzLmZpbmQociA9PiByLmlkID09IGlkKTtcclxuICAgICAgICBpZiAocmVzdGF1cmFudCkgeyAvLyBHb3QgdGhlIHJlc3RhdXJhbnRcclxuICAgICAgICAgIGNhbGxiYWNrKG51bGwsIHJlc3RhdXJhbnQpO1xyXG4gICAgICAgIH0gZWxzZSB7IC8vIFJlc3RhdXJhbnQgZG9lcyBub3QgZXhpc3QgaW4gdGhlIGRhdGFiYXNlXHJcbiAgICAgICAgICBjYWxsYmFjaygnUmVzdGF1cmFudCBkb2VzIG5vdCBleGlzdCcsIG51bGwpO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBGZXRjaCByZXN0YXVyYW50cyBieSBhIGN1aXNpbmUgdHlwZSB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cclxuICAgKi9cclxuICBzdGF0aWMgZmV0Y2hSZXN0YXVyYW50QnlDdWlzaW5lKGN1aXNpbmUsIGNhbGxiYWNrKSB7XHJcbiAgICAvLyBGZXRjaCBhbGwgcmVzdGF1cmFudHMgIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nXHJcbiAgICBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRzKChlcnJvciwgcmVzdGF1cmFudHMpID0+IHtcclxuICAgICAgaWYgKGVycm9yKSB7XHJcbiAgICAgICAgY2FsbGJhY2soZXJyb3IsIG51bGwpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIC8vIEZpbHRlciByZXN0YXVyYW50cyB0byBoYXZlIG9ubHkgZ2l2ZW4gY3Vpc2luZSB0eXBlXHJcbiAgICAgICAgY29uc3QgcmVzdWx0cyA9IHJlc3RhdXJhbnRzLmZpbHRlcihyID0+IHIuY3Vpc2luZV90eXBlID09IGN1aXNpbmUpO1xyXG4gICAgICAgIGNhbGxiYWNrKG51bGwsIHJlc3VsdHMpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEZldGNoIHJlc3RhdXJhbnRzIGJ5IGEgbmVpZ2hib3Job29kIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxyXG4gICAqL1xyXG4gIHN0YXRpYyBmZXRjaFJlc3RhdXJhbnRCeU5laWdoYm9yaG9vZChuZWlnaGJvcmhvb2QsIGNhbGxiYWNrKSB7XHJcbiAgICAvLyBGZXRjaCBhbGwgcmVzdGF1cmFudHNcclxuICAgIERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoKGVycm9yLCByZXN0YXVyYW50cykgPT4ge1xyXG4gICAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgICBjYWxsYmFjayhlcnJvciwgbnVsbCk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgLy8gRmlsdGVyIHJlc3RhdXJhbnRzIHRvIGhhdmUgb25seSBnaXZlbiBuZWlnaGJvcmhvb2RcclxuICAgICAgICBjb25zdCByZXN1bHRzID0gcmVzdGF1cmFudHMuZmlsdGVyKHIgPT4gci5uZWlnaGJvcmhvb2QgPT0gbmVpZ2hib3Job29kKTtcclxuICAgICAgICBjYWxsYmFjayhudWxsLCByZXN1bHRzKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBGZXRjaCByZXN0YXVyYW50cyBieSBhIGN1aXNpbmUgYW5kIGEgbmVpZ2hib3Job29kIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxyXG4gICAqL1xyXG4gIHN0YXRpYyBmZXRjaFJlc3RhdXJhbnRCeUN1aXNpbmVBbmROZWlnaGJvcmhvb2QoY3Vpc2luZSwgbmVpZ2hib3Job29kLCBjYWxsYmFjaykge1xyXG4gICAgLy8gRmV0Y2ggYWxsIHJlc3RhdXJhbnRzXHJcbiAgICBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRzKChlcnJvciwgcmVzdGF1cmFudHMpID0+IHtcclxuICAgICAgaWYgKGVycm9yKSB7XHJcbiAgICAgICAgY2FsbGJhY2soZXJyb3IsIG51bGwpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGxldCByZXN1bHRzID0gcmVzdGF1cmFudHM7XHJcbiAgICAgICAgaWYgKGN1aXNpbmUgIT0gJ2FsbCcpIHsgLy8gZmlsdGVyIGJ5IGN1aXNpbmVcclxuICAgICAgICAgIHJlc3VsdHMgPSByZXN1bHRzLmZpbHRlcihyID0+IHIuY3Vpc2luZV90eXBlID09IGN1aXNpbmUpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAobmVpZ2hib3Job29kICE9ICdhbGwnKSB7IC8vIGZpbHRlciBieSBuZWlnaGJvcmhvb2RcclxuICAgICAgICAgIHJlc3VsdHMgPSByZXN1bHRzLmZpbHRlcihyID0+IHIubmVpZ2hib3Job29kID09IG5laWdoYm9yaG9vZCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNhbGxiYWNrKG51bGwsIHJlc3VsdHMpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEZldGNoIGFsbCBuZWlnaGJvcmhvb2RzIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxyXG4gICAqL1xyXG4gIHN0YXRpYyBmZXRjaE5laWdoYm9yaG9vZHMoY2FsbGJhY2spIHtcclxuICAgIC8vIEZldGNoIGFsbCByZXN0YXVyYW50c1xyXG4gICAgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50cygoZXJyb3IsIHJlc3RhdXJhbnRzKSA9PiB7XHJcbiAgICAgIGlmIChlcnJvcikge1xyXG4gICAgICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICAvLyBHZXQgYWxsIG5laWdoYm9yaG9vZHMgZnJvbSBhbGwgcmVzdGF1cmFudHNcclxuICAgICAgICBjb25zdCBuZWlnaGJvcmhvb2RzID0gcmVzdGF1cmFudHMubWFwKCh2LCBpKSA9PiByZXN0YXVyYW50c1tpXS5uZWlnaGJvcmhvb2QpO1xyXG4gICAgICAgIC8vIFJlbW92ZSBkdXBsaWNhdGVzIGZyb20gbmVpZ2hib3Job29kc1xyXG4gICAgICAgIGNvbnN0IHVuaXF1ZU5laWdoYm9yaG9vZHMgPSBuZWlnaGJvcmhvb2RzLmZpbHRlcigodiwgaSkgPT4gbmVpZ2hib3Job29kcy5pbmRleE9mKHYpID09IGkpO1xyXG4gICAgICAgIGNhbGxiYWNrKG51bGwsIHVuaXF1ZU5laWdoYm9yaG9vZHMpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEZldGNoIGFsbCBjdWlzaW5lcyB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cclxuICAgKi9cclxuICBzdGF0aWMgZmV0Y2hDdWlzaW5lcyhjYWxsYmFjaykge1xyXG4gICAgLy8gRmV0Y2ggYWxsIHJlc3RhdXJhbnRzXHJcbiAgICBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRzKChlcnJvciwgcmVzdGF1cmFudHMpID0+IHtcclxuICAgICAgaWYgKGVycm9yKSB7XHJcbiAgICAgICAgY2FsbGJhY2soZXJyb3IsIG51bGwpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIC8vIEdldCBhbGwgY3Vpc2luZXMgZnJvbSBhbGwgcmVzdGF1cmFudHNcclxuICAgICAgICBjb25zdCBjdWlzaW5lcyA9IHJlc3RhdXJhbnRzLm1hcCgodiwgaSkgPT4gcmVzdGF1cmFudHNbaV0uY3Vpc2luZV90eXBlKTtcclxuICAgICAgICAvLyBSZW1vdmUgZHVwbGljYXRlcyBmcm9tIGN1aXNpbmVzXHJcbiAgICAgICAgY29uc3QgdW5pcXVlQ3Vpc2luZXMgPSBjdWlzaW5lcy5maWx0ZXIoKHYsIGkpID0+IGN1aXNpbmVzLmluZGV4T2YodikgPT0gaSk7XHJcbiAgICAgICAgY2FsbGJhY2sobnVsbCwgdW5pcXVlQ3Vpc2luZXMpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFJlc3RhdXJhbnQgcGFnZSBVUkwuXHJcbiAgICovXHJcbiAgc3RhdGljIHVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCkge1xyXG4gICAgcmV0dXJuIChgLi9yZXN0YXVyYW50Lmh0bWw/aWQ9JHtyZXN0YXVyYW50LmlkfWApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUmVzdGF1cmFudCBpbWFnZSBVUkwuXHJcbiAgICovXHJcbiAgc3RhdGljIGltYWdlVXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50LCBzaXplKSB7XHJcbiAgICBpZihyZXN0YXVyYW50LmlkID09IDEwKSByZXN0YXVyYW50LnBob3RvZ3JhcGggPSAxMDsgXHJcbiAgICByZXR1cm4gKGBkaXN0L2ltZy8ke3Jlc3RhdXJhbnQucGhvdG9ncmFwaH0tJHtzaXplfS53ZWJwYCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBNYXAgbWFya2VyIGZvciBhIHJlc3RhdXJhbnQuXHJcbiAgICovXHJcbiAgc3RhdGljIG1hcE1hcmtlckZvclJlc3RhdXJhbnQocmVzdGF1cmFudCwgbWFwKSB7XHJcbiAgICBjb25zdCBtYXJrZXIgPSBuZXcgZ29vZ2xlLm1hcHMuTWFya2VyKHtcclxuICAgICAgcG9zaXRpb246IHJlc3RhdXJhbnQubGF0bG5nLFxyXG4gICAgICB0aXRsZTogcmVzdGF1cmFudC5uYW1lLFxyXG4gICAgICB1cmw6IERCSGVscGVyLnVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCksXHJcbiAgICAgIG1hcDogbWFwLFxyXG4gICAgICBhbmltYXRpb246IGdvb2dsZS5tYXBzLkFuaW1hdGlvbi5EUk9QfVxyXG4gICAgKTtcclxuICAgIHJldHVybiBtYXJrZXI7XHJcbiAgfVxyXG5cclxuICBzdGF0aWMgYWRkUmV2aWV3KHJldmlldykge1xyXG4gICAgZmV0Y2goREJIZWxwZXIuUkVWSUVXU19VUkwsIHtcclxuICAgICAgbWV0aG9kOiAncG9zdCcsXHJcbiAgICAgIGhlYWRlcnM6IHtcclxuICAgICAgICAnQ29udGVudC1UeXBlJyA6ICdhcHBsaWNhdGlvbi9qc29uJ1xyXG4gICAgICB9LFxyXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeShyZXZpZXcpXHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIHN0YXRpYyBmZXRjaFJldmlld3MoaWQpe1xyXG4gICAgZmV0Y2goREJIZWxwZXIuUkVWSUVXU19VUkwpXHJcbiAgICAgICAgICAudGhlbihmdW5jdGlvbihyZXNwb25zZSl7XHJcbiAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5qc29uKCk7XHJcbiAgICAgICAgfSkudGhlbihyZXZpZXdzPT4ge1xyXG4gICAgICAgICAgY29uc3QgcmV2aWV3c0J5SWQgPSByZXZpZXdzLmZpbHRlcihyID0+IHIucmVzdGF1cmFudF9pZCA9PSBpZCk7XHJcbiAgICAgICAgICBpZihyZXZpZXdzQnlJZClcclxuICAgICAgICAgICAgZmlsbFJldmlld3NIVE1MKHJldmlld3NCeUlkKTtcclxuICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgZmlsbFJldmlld3NIVE1MKG51bGwpO1xyXG4gICAgICAgIH0pO1xyXG4gIH1cclxuXHJcbn1cclxuIl19
